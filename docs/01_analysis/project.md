# Project 模块需求分析

**模块**: 项目管理 (Project)
**分析日期**: 2026-01-11
**状态**: ✅ 需求审计通过

---

## 1. 业务背景

用户需要一个项目管理首页，能够创建、管理多个独立的研究/工作项目。每个项目是一个独立的工作空间，包含来源文件、AI 对话、笔记和画布等内容。类似 NotebookLM 的项目管理模式。

**用户痛点**:
- 多个研究/工作主题需要隔离管理
- 需要快速找到和切换项目
- 需要对项目进行分类整理

---

## 2. 业务主角

| 主角 | 描述 |
|:---|:---|
| 用户 (User) | 个人用户，创建和管理项目，进行研究和知识管理 |
| 系统 (System) | 自动执行后台任务，如索引更新、自动保存 |

---

## 3. 领域对象

| 对象 | 类型 | 职责 |
|:---|:---|:---|
| Project | Entity (聚合根) | 项目实体，包含元数据和内容引用 |
| ProjectIcon | Value Object | 项目图标，从预设图标集选择 |
| Workspace | Value Object | 工作空间分类（研究/开发/个人/自定义） |
| ProjectMetadata | Value Object | 项目元数据（创建时间、更新时间、来源数量等） |
| RecentAccess | Entity | 最近访问记录 |

### 3.1 Project 实体结构

```typescript
interface Project {
  id: string;                    // UUID
  name: string;                  // 项目名称
  icon: ProjectIcon;             // 预设图标
  workspace: string;             // 所属工作空间分类
  isStarred: boolean;            // 是否星标
  createdAt: Date;               // 创建时间
  updatedAt: Date;               // 最后更新时间
  sourcesCount: number;          // 来源数量（计算属性）
  path: string;                  // 本地文件夹路径
}

interface ProjectIcon {
  id: string;                    // 图标 ID
  name: string;                  // 图标名称
  emoji?: string;                // emoji 或图标代码
  color: string;                 // 背景色
}

interface Workspace {
  id: string;
  name: string;                  // 分类名称
  isSystem: boolean;             // 是否系统预设
  order: number;                 // 排序
}
```

### 3.2 项目文件夹结构

```
~/DeskLab/                       # 应用数据根目录
├── projects/                    # 项目根目录
│   └── {project-id}/            # 单个项目文件夹
│       ├── project.json         # 项目元数据
│       ├── sources/             # 来源文件
│       │   ├── pdf/
│       │   ├── docx/
│       │   ├── images/
│       │   └── markdown/
│       ├── notes/               # 笔记文件 (.md)
│       ├── canvas/              # 画布文件 (.canvas.json)
│       └── chat/                # 对话历史
├── db/                          # 全局数据库
│   ├── index.db                 # FTS + 向量索引
│   └── metadata.db              # 元数据
├── cache/                       # 缓存
│   └── thumbnails/              # 缩略图
└── config/                      # 配置
    └── settings.json
```

---

## 4. 用例清单

| UC-ID | 用例名称 | 主角 | 优先级 | 关联需求 |
|:---|:---|:---|:---|:---|
| UC-001 | 查看项目列表 | 用户 | P0 | REQ-F-001 |
| UC-002 | 创建新项目 | 用户 | P0 | REQ-F-002 |
| UC-003 | 重命名项目 | 用户 | P0 | REQ-F-002 |
| UC-004 | 删除项目 | 用户 | P0 | REQ-F-002 |
| UC-005 | 查看项目信息 | 用户 | P1 | REQ-F-003 |
| UC-006 | 管理工作空间分类 | 用户 | P1 | REQ-F-004 |
| UC-007 | 项目排序 | 用户 | P2 | REQ-F-005 |
| UC-008 | 星标项目 | 用户 | P2 | REQ-F-006 |
| UC-009 | 查看最近访问 | 用户 | P2 | REQ-F-007 |
| UC-010 | 全局搜索 | 用户 | P1 | REQ-F-008 |

---

## 5. 用例详情

### UC-001: 查看项目列表

**主角**: 用户
**前置条件**: 应用已启动
**触发条件**: 用户进入首页

**基本流程**:
1. 系统从本地加载所有项目元数据
2. 系统按当前排序规则排序项目
3. 系统以卡片网格形式展示项目
4. 每张卡片显示：图标、名称、更新时间、来源数量

**异常流程**:
- E1: 无项目时显示空状态引导

**验收条件**:
```
AC-1: 项目卡片网格展示
Given: 用户有 N 个项目
When: 用户进入首页
Then: 显示 N 张项目卡片，按网格布局排列

AC-2: 卡片信息完整
Given: 项目卡片可见
When: 用户查看卡片
Then: 卡片显示图标、标题、更新时间、来源数量

AC-3: 空状态引导
Given: 用户无任何项目
When: 用户进入首页
Then: 显示空状态提示和"创建项目"按钮
```

---

### UC-002: 创建新项目

**主角**: 用户
**前置条件**: 用户在首页
**触发条件**: 用户点击"新建项目"按钮

**基本流程**:
1. 用户点击"新建项目"按钮
2. 系统弹出创建对话框
3. 用户输入项目名称
4. 用户选择预设图标
5. 用户选择工作空间分类（可选）
6. 用户点击"创建"
7. 系统创建项目文件夹结构
8. 系统在数据库登记项目
9. 系统刷新项目列表
10. 系统进入新项目的工作室界面

**异常流程**:
- E1: 项目名称为空 → 提示"请输入项目名称"
- E2: 项目名称重复 → 提示"项目名称已存在"
- E3: 磁盘空间不足 → 提示错误

**验收条件**:
```
AC-1: 创建项目成功
Given: 用户在首页
When: 用户输入名称"我的研究"，选择图标，点击创建
Then: 项目创建成功，跳转到项目工作室

AC-2: 项目文件夹创建
Given: 项目创建成功
When: 检查文件系统
Then: 项目文件夹结构已创建（sources/notes/canvas/chat）

AC-3: 空名称校验
Given: 用户在创建对话框
When: 用户未输入名称直接点击创建
Then: 显示"请输入项目名称"提示
```

---

### UC-003: 重命名项目

**主角**: 用户
**前置条件**: 项目已存在
**触发条件**: 用户右键项目卡片选择"重命名"

**基本流程**:
1. 用户右键点击项目卡片
2. 系统显示上下文菜单
3. 用户选择"重命名"
4. 卡片标题变为可编辑状态
5. 用户修改名称并按回车
6. 系统更新项目元数据
7. 系统刷新显示

**验收条件**:
```
AC-1: 重命名成功
Given: 项目"旧名称"存在
When: 用户重命名为"新名称"
Then: 项目名称更新为"新名称"

AC-2: ESC 取消
Given: 用户正在编辑名称
When: 用户按 ESC
Then: 取消编辑，恢复原名称
```

---

### UC-004: 删除项目

**主角**: 用户
**前置条件**: 项目已存在
**触发条件**: 用户右键项目卡片选择"删除"

**基本流程**:
1. 用户右键点击项目卡片
2. 用户选择"删除"
3. 系统弹出确认对话框，显示项目名称
4. 用户确认删除
5. 系统移动项目文件夹到回收站（或删除）
6. 系统从数据库移除项目记录
7. 系统刷新项目列表

**验收条件**:
```
AC-1: 删除确认
Given: 用户选择删除项目
When: 系统弹出确认框
Then: 确认框显示"确定删除项目「XXX」吗？"

AC-2: 确认后删除
Given: 用户在确认框
When: 用户点击"确认"
Then: 项目从列表消失，文件夹被删除

AC-3: 取消删除
Given: 用户在确认框
When: 用户点击"取消"
Then: 对话框关闭，项目保留
```

---

### UC-006: 管理工作空间分类

**主角**: 用户
**前置条件**: 用户在首页
**触发条件**: 用户操作侧边栏分类

**基本流程**:
1. 系统在侧边栏显示分类列表（全部/研究/开发/个人）
2. 用户点击分类筛选项目
3. 用户可添加自定义分类
4. 用户可将项目拖拽到分类

**验收条件**:
```
AC-1: 分类筛选
Given: 用户有不同分类的项目
When: 用户点击"研究"分类
Then: 只显示"研究"分类下的项目

AC-2: 预设分类
Given: 用户进入首页
When: 查看侧边栏
Then: 显示"全部"、"研究"、"开发"、"个人"分类

AC-3: 自定义分类
Given: 用户在侧边栏
When: 用户点击"添加分类"并输入名称
Then: 新分类出现在列表中
```

---

### UC-007: 项目排序

**主角**: 用户
**前置条件**: 有多个项目
**触发条件**: 用户选择排序方式

**验收条件**:
```
AC-1: 按修改时间排序（默认）
Given: 项目列表可见
When: 选择"按最后修改时间"
Then: 最近修改的项目排在前面

AC-2: 按名称排序
Given: 项目列表可见
When: 选择"按名称"
Then: 项目按字母顺序排列

AC-3: 按创建日期排序
Given: 项目列表可见
When: 选择"按创建日期"
Then: 最新创建的项目排在前面
```

---

### UC-008: 星标项目

**主角**: 用户
**前置条件**: 项目已存在
**触发条件**: 用户点击星标图标

**验收条件**:
```
AC-1: 添加星标
Given: 项目未星标
When: 用户点击星标图标
Then: 项目显示星标，置顶显示

AC-2: 取消星标
Given: 项目已星标
When: 用户再次点击星标
Then: 星标取消，项目回到正常位置
```

---

### UC-010: 全局搜索

**主角**: 用户
**前置条件**: 应用已启动
**触发条件**: 用户按 Cmd+K 或点击搜索图标

**基本流程**:
1. 用户按 Cmd+K
2. 系统弹出搜索面板
3. 用户输入关键词
4. 系统实时显示匹配结果（项目/来源/笔记）
5. 用户点击结果项
6. 系统跳转到对应位置

**验收条件**:
```
AC-1: 快捷键打开
Given: 用户在任意页面
When: 用户按 Cmd+K (macOS) 或 Ctrl+K (Windows)
Then: 搜索面板弹出

AC-2: 实时搜索
Given: 搜索面板打开
When: 用户输入"研究"
Then: 实时显示包含"研究"的项目/来源/笔记

AC-3: 结果跳转
Given: 搜索结果显示
When: 用户点击某个项目结果
Then: 跳转到该项目工作室
```

---

## 6. 数据流图

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   用户      │────>│   首页UI    │────>│  项目列表   │
└─────────────┘     └─────────────┘     └─────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ 项目操作    │
                    │ CRUD        │
                    └─────────────┘
                           │
              ┌────────────┼────────────┐
              ▼            ▼            ▼
       ┌──────────┐ ┌──────────┐ ┌──────────┐
       │ 文件系统 │ │ SQLite   │ │ 搜索索引 │
       │ 项目文件 │ │ 元数据   │ │ FTS5     │
       └──────────┘ └──────────┘ └──────────┘
```

---

## 7. 预设图标集

MVP 阶段提供以下预设图标：

| 分类 | 图标 |
|:---|:---|
| 通用 | 文档、文件夹、书籍、笔记、星星 |
| 研究 | 灯泡、放大镜、实验、图表、脑图 |
| 开发 | 代码、终端、bug、火箭、齿轮 |
| 创意 | 画笔、调色板、相机、音乐、视频 |
| 工作 | 日历、任务、邮件、团队、目标 |

每个图标配有 8 种背景色可选。

---

## 8. 非功能约束

| 约束 | 描述 |
|:---|:---|
| REQ-N-001 | macOS 和 Windows 双平台支持 |
| REQ-N-002 | 离线可用，无网络也能创建/管理项目 |
| REQ-N-003 | 所有数据存储在本地 |
| REQ-N-004 | 首页加载 < 1s (100 个项目) |

---

**文档版本**: v1.0
**作者**: Claude 需求分析师
**下一步**: 提交审计 → 架构设计
